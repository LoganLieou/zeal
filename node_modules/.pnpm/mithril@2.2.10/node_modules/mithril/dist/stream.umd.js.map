{"version":3,"file":"stream.umd.js","sources":["../src/entry/stream.esm.js","../src/entry/stream.umd.js"],"sourcesContent":["var STATE_PENDING = 1\nvar STATE_ACTIVE = 2\nvar STATE_CHANGING = 3\nvar STATE_ENDED = 4\n\nvar streamSet = (stream, value) => {\n\tif (value !== SKIP) {\n\t\tstream._v = value\n\t\tif (stream._s !== STATE_ENDED) {\n\t\t\tstreamChanging(stream)\n\t\t\tstream._s = STATE_ACTIVE\n\t\t\t// Cloning the list to ensure it's still iterated in intended\n\t\t\t// order\n\t\t\tvar streams = stream._d.slice()\n\t\t\tvar fns = stream._f.slice()\n\t\t\tfor (var i = 0; i < streams.length; i++) {\n\t\t\t\tif (streams[i]._s !== STATE_ENDED) {\n\t\t\t\t\tstreamSet(streams[i], fns[i](stream._v))\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\treturn stream._v\n}\n\nvar streamChanging = (stream) => {\n\tif (stream._s !== STATE_ENDED) stream._s = STATE_CHANGING\n\tfor (var s of stream._d) streamChanging(s)\n}\n\nvar streamMap = (stream, fn, ignoreInitial) => {\n\tvar target = ignoreInitial ? Stream() : Stream(fn(stream._v))\n\ttarget._p.push(stream)\n\tstream._d.push(target)\n\tstream._f.push(fn)\n\treturn target\n}\n\nvar Stream = (...args) => {\n\tvar stream = (...args) => streamSet(stream, args.length ? args[0] : SKIP)\n\n\tObject.setPrototypeOf(stream, Stream.prototype)\n\n\tstream._s = args.length && args[0] !== SKIP ? STATE_ACTIVE : STATE_PENDING\n\tstream._v = args.length ? args[0] : undefined\n\tstream._d = []\n\tstream._f = []\n\tstream._p = []\n\tstream._e = null\n\n\treturn stream\n}\n\nStream[\"fantasy-land/of\"] = Stream\n\nStream.prototype = Object.create(Function.prototype, Object.getOwnPropertyDescriptors({\n\tconstructor: Stream,\n\tmap(fn) { return streamMap(this, fn, this._s !== STATE_ACTIVE) },\n\t\"fantasy-land/ap\"(x) { return combine(() => (0, x._v)(this._v), [x, this]) },\n\ttoJSON() {\n\t\tvar value = this._v\n\t\treturn (value != null && typeof value.toJSON === \"function\" ? value.toJSON() : value)\n\t},\n\tget end() {\n\t\tif (!this._e) {\n\t\t\tthis._e = Stream()\n\t\t\tstreamMap(this._e, (value) => {\n\t\t\t\tif (value === true) {\n\t\t\t\t\tfor (var p of this._p) {\n\t\t\t\t\t\tvar childIndex = p._d.indexOf(this)\n\t\t\t\t\t\tif (childIndex >= 0) {\n\t\t\t\t\t\t\tp._d.splice(childIndex, 1)\n\t\t\t\t\t\t\tp._f.splice(childIndex, 1)\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tthis._s = STATE_ENDED\n\t\t\t\t\tthis._p.length = this._d.length = this._f.length = 0\n\t\t\t\t}\n\t\t\t\treturn value\n\t\t\t}, true)\n\t\t}\n\t\treturn this._e\n\t},\n}))\n\nStream.prototype[\"fantasy-land/map\"] = Stream.prototype.map\n\nvar SKIP = Stream.SKIP = {}\n\nvar combine = Stream.combine = (fn, streams) => {\n\tif (streams.some((s) => s.constructor !== Stream)) {\n\t\tthrow new Error(\"Ensure that each item passed to stream.combine/stream.merge/lift is a stream.\")\n\t}\n\tvar ready = streams.every((s) => s._s === STATE_ACTIVE)\n\tvar stream = ready ? Stream(fn(streams)) : Stream()\n\n\tvar changed = []\n\n\tvar mappers = streams.map((s) => streamMap(s, (value) => {\n\t\tchanged.push(s)\n\t\tif (ready || streams.every((s) => s._s !== STATE_PENDING)) {\n\t\t\tready = true\n\t\t\tstreamSet(stream, fn(changed))\n\t\t\tchanged = []\n\t\t}\n\t\treturn value\n\t}, true))\n\n\tvar endStream = stream.end.map((value) => {\n\t\tif (value === true) {\n\t\t\tfor (var mapper of mappers) mapper.end(true)\n\t\t\tendStream.end(true)\n\t\t}\n\t\treturn undefined\n\t})\n\n\treturn stream\n}\n\nStream.merge = (streams) => combine(() => streams.map((s) => s._v), streams)\n\nStream.scan = (fn, acc, origin) => {\n\tvar stream = streamMap(origin, (v) => {\n\t\tvar next = fn(acc, v)\n\t\tif (next !== SKIP) acc = next\n\t\treturn next\n\t}, origin._s !== STATE_ACTIVE)\n\tstreamSet(stream, acc)\n\treturn stream\n}\n\nStream.scanMerge = (tuples, seed) => {\n\tvar streams = tuples.map((tuple) => tuple[0])\n\n\tvar stream = combine((changed) => {\n\t\tfor (var i = 0; i < streams.length; i++) {\n\t\t\tif (changed.includes(streams[i])) {\n\t\t\t\tseed = tuples[i][1](seed, streams[i]._v)\n\t\t\t}\n\t\t}\n\t\treturn seed\n\t}, streams)\n\n\tstreamSet(stream, seed)\n\n\treturn stream\n}\n\nStream.lift = (fn, ...streams) => combine(() => fn(...streams.map((s) => s._v)), streams)\n\nexport {Stream as default}\n","/* global window: false, module: false */\nimport Stream from \"./stream.esm.js\"\n\nif (typeof module !== \"undefined\") module[\"exports\"] = Stream\nelse if (typeof window.m === \"function\" && !(\"stream\" in window.m)) window.m.stream = Stream\nelse window.m = {stream : Stream}\n"],"names":[],"mappings":"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"}